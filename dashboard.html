<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard Crowd Playlist â€“ Moodify</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #ffd6f6, #d9c7ff, #c6e6ff);
        font-family: 'Poppins', sans-serif;
        color: #333;
        overflow-x: hidden;
    }

    header {
        text-align: center;
        padding: 25px;
        font-size: 28px;
        font-weight: 600;
        color: #5e2d79;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }

    .container {
        width: 90%;
        max-width: 900px;
        margin: auto;
        margin-top: 20px;
    }

    /* SONG CARD */
    .song-card {
        background: white;
        padding: 18px 20px;
        border-radius: 18px;
        margin-bottom: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        animation: fadeIn 0.4s ease;
    }

    .info {
        line-height: 1.5;
        font-size: 16px;
    }

    .mood-tag {
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        text-transform: capitalize;
        color: white;
    }

    /* Warna mood */
    .happy { background: #ffb84c; }
    .calm { background: #88e6cd; }
    .blue { background: #6ca8ff; }
    .angry { background: #ff6b6b; }
    .sad { background: #ce9bff; }

    @keyframes fadeIn {
        from {opacity: 0; transform: translateY(10px);}
        to {opacity: 1; transform: translateY(0);}
    }
</style>
</head>

<body>

<header>ðŸŽ§ Crowd Playlist Dashboard â€“ Moodify</header>

<!-- PIE CHART -->
<canvas id="moodPieChart" width="320" height="320"
style="display:block; margin: 20px auto 40px;"></canvas>

<div class="container">
    <div id="songList"></div>
</div>

<!-- FIREBASE SCRIPT -->
<script type="module">
    import { initializeApp } 
        from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, orderBy } 
        from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDJYuLpI7flTzq44Rjuvp_-Uk-001fe4jM",
        authDomain: "moodify-crowdplay.firebaseapp.com",
        projectId: "moodify-crowdplay",
        storageBucket: "moodify-crowdplay.firebasestorage.app",
        messagingSenderId: "1017921695722",
        appId: "1:1017921695722:web:d57678bef5930da17ccc93"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const songList = document.getElementById("songList");

    /* ============================
       PIE CHART CONFIGURATION
    ============================= */

    let moodChart;
    const ctx = document.getElementById("moodPieChart").getContext("2d");

    function updateMoodChart(moodCount) {
        const labels = Object.keys(moodCount);
        const values = Object.values(moodCount);

        if (moodChart) moodChart.destroy();

        moodChart = new Chart(ctx, {
            type: "pie",
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: [
                        "#ce9bff", // sad
                        "#ffcf7d", // happy
                        "#b7f7df", // calm
                        "#ff8b8b"  // angry
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                plugins: {
                    legend: {
                        labels: { color: "#333" }
                    }
                }
            }
        });
    }

    /* ============================
       REALTIME PLAYLIST + MOOD COUNT
    ============================= */

    const q = query(collection(db, "playlist"), orderBy("time", "desc"));

    onSnapshot(q, (snapshot) => {
        songList.innerHTML = "";

        let moodCount = {
            sad: 0,
            happy: 0,
            calm: 0,
            angry: 0
        };

        snapshot.forEach((doc) => {
            const song = doc.data();
            const mood = song.mood?.toLowerCase();

            if (moodCount[mood] !== undefined) {
                moodCount[mood]++;
            }

            const card = `
                <div class="song-card">
                    <div class="info">
                        <strong>${song.title}</strong><br>
                        <span>${song.artist}</span>
                    </div>
                    <div class="mood-tag ${mood}">
                        ${mood}
                    </div>
                </div>
            `;

            songList.innerHTML += card;
        });

        updateMoodChart(moodCount);
    });
</script>

</body>
</html>
